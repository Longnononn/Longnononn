local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local humanoid = char:WaitForChild("Humanoid")
local hrp = char:WaitForChild("HumanoidRootPart")

local speedDefault, speedBoost = 16, 28
local hasSpeed, hasNoclip, hasSteal = false, false, false
local stealRange = 15
local lastSteal = 0
local cooldown = 1

-- GUI tạo nhanh
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui")); gui.Name="StealCore"
local btns = {
  toggleGui = Instance.new("TextButton", gui),
  speedBtn    = Instance.new("TextButton", gui),
  stealBtn    = Instance.new("TextButton", gui),
  tpBtn       = Instance.new("TextButton", gui),
}
btns.toggleGui.Size, btns.toggleGui.Position = UDim2.new(0,40,0,10), UDim2.new(0,10,0,10)
btns.toggleGui.Text = "+"
btns.speedBtn.Size, btns.speedBtn.Position = UDim2.new(0,160,0,50), UDim2.new(0,10,0,50)
btns.speedBtn.Text = "Speed+Noclip: OFF"
btns.stealBtn.Size, btns.stealBtn.Position = UDim2.new(0,160,0,90), UDim2.new(0,10,0,90)
btns.stealBtn.Text = "Auto Steal: OFF"
btns.tpBtn.Size, btns.tpBtn.Position = UDim2.new(0,160,0,130), UDim2.new(0,10,0,130)
btns.tpBtn.Text = "TP Next Brainrot"
for _,b in pairs(btns) do b.BackgroundColor3=Color3.fromRGB(50,50,50); b.TextScaled=true; Instance.new("UICorner",b) end
btns.toggleGui.Visible = true
for i,b in pairs({btns.speedBtn, btns.stealBtn, btns.tpBtn}) do b.Visible=false end

btns.toggleGui.MouseButton1Click:Connect(function()
  for _,b in pairs({btns.speedBtn, btns.stealBtn, btns.tpBtn}) do b.Visible = not b.Visible end
end)

-- Speed + Noclip
btns.speedBtn.MouseButton1Click:Connect(function()
  hasSpeed = not hasSpeed
  hasNoclip = hasSpeed
  humanoid.WalkSpeed = hasSpeed and speedBoost or speedDefault
  btns.speedBtn.Text = "Speed+Noclip: " .. (hasSpeed and "ON" or "OFF")
end)

-- Toggle Auto Steal
btns.stealBtn.MouseButton1Click:Connect(function()
  hasSteal = not hasSteal
  btns.stealBtn.Text = "Auto Steal: " .. (hasSteal and "ON" or "OFF")
end)

-- Manual TP next Brainrot
btns.tpBtn.MouseButton1Click:Connect(function()
  local nextItem = nil
  local minDist = 1e9
  for _,obj in pairs(Workspace:GetDescendants()) do
    if obj:IsA("BasePart") and obj.Name=="StealableItem" then
      local d = (obj.Position - hrp.Position).Magnitude
      if d < minDist then nextItem, minDist = obj, d end
    end
  end
  if nextItem then
    hrp.CFrame = CFrame.new(nextItem.Position + Vector3.new(0,3,0))
  end
end)

-- Noclip mỗi frame
RunService.Stepped:Connect(function()
  if hasNoclip then
    for _,p in pairs(char:GetDescendants()) do
      if p:IsA("BasePart") and p.Name~="HumanoidRootPart" then p.CanCollide = false end
    end
  end
end)

-- Anti Kick
pcall(function()
  local mt=getrawmetatable(game); setreadonly(mt,false)
  local old=mt.__namecall
  mt.__namecall = newcclosure(function(s,...)
    if getnamecallmethod()=="Kick" then return end
    return old(s,...)
  end)
  setreadonly(mt,true)
end)

-- Auto Steal logic
local function doStealAll()
  local remote = ReplicatedStorage:FindFirstChild("StealPet", true)
  if not remote then return end
  local startCF = hrp.CFrame
  local p0 = hrp.Position
  for _,obj in pairs(Workspace:GetDescendants()) do
    if obj:IsA("BasePart") and obj.Name=="StealableItem" then
      local d=(obj.Position - p0).Magnitude
      if d <= stealRange then
        hrp.CFrame = CFrame.new(obj.Position + Vector3.new(0,1,0))
        task.wait(0.03)
        remote:FireServer(obj)
        task.wait(0.05)
        hrp.CFrame = startCF
        task.wait(0.05)
      end
    end
  end
end

task.spawn(function()
  while true do
    if hasSteal and tick()-lastSteal>=cooldown then
      doStealAll()
      lastSteal = tick()
    end
    task.wait(0.1)
  end
end)
