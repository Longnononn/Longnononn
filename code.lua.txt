local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local hrp = character:WaitForChild("HumanoidRootPart")

local walkSpeedDefault = 16
local walkSpeedBoost = 28
local speedEnabled = false
local noclipEnabled = false
local quickStealEnabled = false

local stealRange = 15
local lastStealAttemptTime = 0
local stealActionCooldown = 1

-- GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SysCoreUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local creditLabel = Instance.new("TextLabel", screenGui)
creditLabel.Size = UDim2.new(0, 160, 0, 25)
creditLabel.Position = UDim2.new(0, 10, 0, 10)
creditLabel.BackgroundTransparency = 1
creditLabel.Text = "script by Long dzz"
creditLabel.TextColor3 = Color3.new(1, 1, 1)
creditLabel.Font = Enum.Font.Gotham
creditLabel.TextScaled = true

local toggleGuiButton = Instance.new("TextButton", screenGui)
toggleGuiButton.Size = UDim2.new(0, 40, 0, 40)
toggleGuiButton.Position = UDim2.new(0, 10, 0, 45)
toggleGuiButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
toggleGuiButton.Text = "+"
toggleGuiButton.TextScaled = true
toggleGuiButton.TextColor3 = Color3.new(1, 1, 1)
toggleGuiButton.BorderSizePixel = 0
toggleGuiButton.Font = Enum.Font.GothamBlack
Instance.new("UICorner", toggleGuiButton)

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0, 160, 0, 130)
mainFrame.Position = UDim2.new(0, 60, 0, 45)
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
mainFrame.Visible = false
Instance.new("UICorner", mainFrame)

local speedBtn = Instance.new("TextButton", mainFrame)
speedBtn.Size = UDim2.new(1, -20, 0, 30)
speedBtn.Position = UDim2.new(0, 10, 0, 10)
speedBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
speedBtn.Text = "Speed+Noclip: OFF"
speedBtn.TextScaled = true
speedBtn.Font = Enum.Font.GothamBold
speedBtn.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", speedBtn)

local stealBtn = Instance.new("TextButton", mainFrame)
stealBtn.Size = UDim2.new(1, -20, 0, 30)
stealBtn.Position = UDim2.new(0, 10, 0, 50)
stealBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
stealBtn.Text = "Cướp Nhanh: OFF"
stealBtn.TextScaled = true
stealBtn.Font = Enum.Font.GothamBold
stealBtn.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", stealBtn)

local tpBtn = Instance.new("TextButton", mainFrame)
tpBtn.Size = UDim2.new(1, -20, 0, 30)
tpBtn.Position = UDim2.new(0, 10, 0, 90)
tpBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
tpBtn.Text = "Dịch Chuyển Xuyên Tường"
tpBtn.TextScaled = true
tpBtn.Font = Enum.Font.GothamBold
tpBtn.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", tpBtn)

-- Toggle UI
toggleGuiButton.MouseButton1Click:Connect(function()
	mainFrame.Visible = not mainFrame.Visible
end)

-- Toggle Speed+Noclip
speedBtn.MouseButton1Click:Connect(function()
	speedEnabled = not speedEnabled
	noclipEnabled = speedEnabled
	if humanoid then
		humanoid.WalkSpeed = speedEnabled and walkSpeedBoost or walkSpeedDefault
	end
	speedBtn.Text = "Speed+Noclip: " .. (speedEnabled and "ON" or "OFF")
	speedBtn.BackgroundColor3 = speedEnabled and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(255, 0, 0)
end)

-- Toggle Quick Steal
stealBtn.MouseButton1Click:Connect(function()
	quickStealEnabled = not quickStealEnabled
	stealBtn.Text = "Cướp Nhanh: " .. (quickStealEnabled and "ON" or "OFF")
	stealBtn.BackgroundColor3 = quickStealEnabled and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(255, 100, 0)
end)

-- Manual TP
tpBtn.MouseButton1Click:Connect(function()
	if hrp then
		local dir = Workspace.CurrentCamera.CFrame.LookVector
		hrp.CFrame = hrp.CFrame + dir * 3
	end
end)

-- Noclip real time
RunService.Stepped:Connect(function()
	if noclipEnabled and character then
		for _, part in pairs(character:GetDescendants()) do
			if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
				part.CanCollide = false
			end
		end
	end
end)

-- Perform auto steal with teleport trick
local function performQuickSteal()
	if not hrp then return end
	local remote = ReplicatedStorage:FindFirstChild("StealPet", true)
	if not remote or not remote:IsA("RemoteEvent") then return end

	local origin = hrp.CFrame
	local pos = hrp.Position

	for _, obj in pairs(Workspace:GetDescendants()) do
		if obj:IsA("BasePart") and obj.Name == "StealableItem" then
			local dist = (obj.Position - pos).Magnitude
			if dist <= stealRange then
				hrp.CFrame = CFrame.new(obj.Position + Vector3.new(0, 1, 0))
				task.wait(0.03)
				remote:FireServer(obj)
				task.wait(0.05)
				hrp.CFrame = origin
				task.wait(0.05)
			end
		end
	end
end

-- Auto steal loop
task.spawn(function()
	while true do
		if quickStealEnabled and tick() - lastStealAttemptTime >= stealActionCooldown then
			performQuickSteal()
			lastStealAttemptTime = tick()
		end
		task.wait(0.1)
	end
end)

-- Handle respawn
player.CharacterAdded:Connect(function(char)
	character = char
	humanoid = char:WaitForChild("Humanoid")
	hrp = char:WaitForChild("HumanoidRootPart")
	task.wait(0.25)
	if speedEnabled then
		humanoid.WalkSpeed = walkSpeedBoost
	end
end)

-- Anti-Kick
pcall(function()
	local mt = getrawmetatable(game)
	setreadonly(mt, false)
	local old = mt.__namecall
	mt.__namecall = newcclosure(function(self, ...)
		if getnamecallmethod() == "Kick" then
			return
		end
		return old(self, ...)
	end)
	setreadonly(mt, true)
end)
-- ESP Highlight Stealable Items
local function createESP(target)
	local hl = Instance.new("Highlight")
	hl.Name = "ESP_HL"
	hl.Adornee = target
	hl.FillTransparency = 1
	hl.OutlineTransparency = 0
	hl.OutlineColor = Color3.fromRGB(0, 255, 0)
	hl.Parent = target
end

local function applyESPToAll()
	for _, obj in ipairs(Workspace:GetDescendants()) do
		if obj:IsA("BasePart") and obj.Name == "StealableItem" and not obj:FindFirstChild("ESP_HL") then
			createESP(obj)
		end
	end
end

-- Theo dõi item mới được thêm vào Workspace
Workspace.DescendantAdded:Connect(function(desc)
	if desc:IsA("BasePart") and desc.Name == "StealableItem" then
		task.wait(0.1)
		if not desc:FindFirstChild("ESP_HL") then
			createESP(desc)
		end
	end
end)

-- Chạy ban đầu
applyESPToAll()
