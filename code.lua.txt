local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local hrp = character:WaitForChild("HumanoidRootPart")

local walkSpeedDefault = 16
local walkSpeedBoost = 28
local speedEnabled = false
local noclipEnabled = false
local quickStealEnabled = false

local stealRange = 25
local lastStealAttemptTime = 0
local stealActionCooldown = 1

-- GUI
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "SysCoreUI"
screenGui.ResetOnSpawn = false

local credit = Instance.new("TextLabel", screenGui)
credit.Size = UDim2.new(0,160,0,25)
credit.Position = UDim2.new(0,10,0,10)
credit.BackgroundTransparency = 1
credit.Text = "script by Long dzz"
credit.TextColor3 = Color3.new(1,1,1)
credit.Font = Enum.Font.Gotham
credit.TextScaled = true

local toggleGuiButton = Instance.new("TextButton", screenGui)
toggleGuiButton.Size = UDim2.new(0,40,0,40)
toggleGuiButton.Position = UDim2.new(0,10,0,45)
toggleGuiButton.BackgroundColor3 = Color3.fromRGB(0,170,255)
toggleGuiButton.Text = "+"
toggleGuiButton.TextScaled = true
toggleGuiButton.Font = Enum.Font.GothamBlack
toggleGuiButton.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", toggleGuiButton)

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0,160,0,130)
mainFrame.Position = UDim2.new(0,60,0,45)
mainFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
mainFrame.Visible = false
Instance.new("UICorner", mainFrame)

toggleGuiButton.MouseButton1Click:Connect(function()
	mainFrame.Visible = not mainFrame.Visible
end)

local speedBtn = Instance.new("TextButton", mainFrame)
speedBtn.Size = UDim2.new(1,-20,0,30)
speedBtn.Position = UDim2.new(0,10,0,10)
speedBtn.BackgroundColor3 = Color3.fromRGB(255,0,0)
speedBtn.Text = "Speed+Noclip: OFF"
speedBtn.Font = Enum.Font.GothamBold
speedBtn.TextScaled = true
speedBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", speedBtn)

local stealBtn = Instance.new("TextButton", mainFrame)
stealBtn.Size = UDim2.new(1,-20,0,30)
stealBtn.Position = UDim2.new(0,10,0,50)
stealBtn.BackgroundColor3 = Color3.fromRGB(255,100,0)
stealBtn.Text = "Cướp Nhanh: OFF"
stealBtn.Font = Enum.Font.GothamBold
stealBtn.TextScaled = true
stealBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", stealBtn)

local teleportBtn = Instance.new("TextButton", mainFrame)
teleportBtn.Size = UDim2.new(1,-20,0,30)
teleportBtn.Position = UDim2.new(0,10,0,90)
teleportBtn.BackgroundColor3 = Color3.fromRGB(0,100,255)
teleportBtn.Text = "Dịch Chuyển"
teleportBtn.Font = Enum.Font.GothamBold
teleportBtn.TextScaled = true
teleportBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", teleportBtn)

speedBtn.MouseButton1Click:Connect(function()
	speedEnabled = not speedEnabled
	noclipEnabled = speedEnabled
	humanoid.WalkSpeed = speedEnabled and walkSpeedBoost or walkSpeedDefault
	speedBtn.Text = "Speed+Noclip: " .. (speedEnabled and "ON" or "OFF")
	speedBtn.BackgroundColor3 = speedEnabled and Color3.fromRGB(0,200,0) or Color3.fromRGB(255,0,0)
end)

stealBtn.MouseButton1Click:Connect(function()
	quickStealEnabled = not quickStealEnabled
	stealBtn.Text = "Cướp Nhanh: " .. (quickStealEnabled and "ON" or "OFF")
	stealBtn.BackgroundColor3 = quickStealEnabled and Color3.fromRGB(0,200,0) or Color3.fromRGB(255,100,0)
end)

teleportBtn.MouseButton1Click:Connect(function()
	local dir = Workspace.CurrentCamera.CFrame.LookVector
	hrp.CFrame = hrp.CFrame + dir * 5
end)

-- Noclip
RunService.Stepped:Connect(function()
	if noclipEnabled then
		for _, p in ipairs(character:GetDescendants()) do
			if p:IsA("BasePart") and p.Name ~= "HumanoidRootPart" then
				p.CanCollide = false
			end
		end
	end
end)

-- Quick Steal
local function quickSteal()
	local remote = ReplicatedStorage:FindFirstChild("StealPet", true)
	if not remote or not remote:IsA("RemoteEvent") then return end

	local origin = hrp.CFrame

	for _, obj in pairs(Workspace:GetDescendants()) do
		if obj.Name == "StealableItem" then
			local part = obj:IsA("BasePart") and obj or obj:FindFirstChildWhichIsA("BasePart")
			if part and (part.Position - hrp.Position).Magnitude <= stealRange then
				hrp.CFrame = CFrame.new(part.Position + Vector3.new(0,1,0))
				task.wait(0.03)
				remote:FireServer(obj)
				task.wait(0.05)
				hrp.CFrame = origin
			end
		end
	end
end

task.spawn(function()
	while true do
		if quickStealEnabled and tick() - lastStealAttemptTime >= stealActionCooldown then
			quickSteal()
			lastStealAttemptTime = tick()
		end
		task.wait(0.1)
	end
end)

-- ESP bằng Box
local function createESP(part)
	if not part:IsA("BasePart") then return end
	if part:FindFirstChild("BoxESP") then return end
	local box = Instance.new("BoxHandleAdornment")
	box.Name = "BoxESP"
	box.Adornee = part
	box.AlwaysOnTop = true
	box.ZIndex = 5
	box.Size = part.Size + Vector3.new(0.1,0.1,0.1)
	box.Color3 = Color3.fromRGB(0,255,0)
	box.Transparency = 0.3
	box.Parent = part
end

local function findBase(obj)
	if obj:IsA("BasePart") then return obj end
	for _,v in ipairs(obj:GetDescendants()) do
		if v:IsA("BasePart") then return v end
	end
end

local function espAll()
	for _, o in ipairs(Workspace:GetDescendants()) do
		if o.Name == "StealableItem" then
			local bp = findBase(o)
			if bp then createESP(bp) end
		end
	end
end

Workspace.DescendantAdded:Connect(function(obj)
	if obj.Name == "StealableItem" then
		task.wait(0.1)
		local bp = findBase(obj)
		if bp then createESP(bp) end
	end
end)

espAll()

-- Respawn
player.CharacterAdded:Connect(function(char)
	character = char
	humanoid = char:WaitForChild("Humanoid")
	hrp = char:WaitForChild("HumanoidRootPart")
	if speedEnabled then
		humanoid.WalkSpeed = walkSpeedBoost
	end
end)

-- AntiKick
pcall(function()
	local mt = getrawmetatable(game)
	setreadonly(mt, false)
	local old = mt.__namecall
	mt.__namecall = newcclosure(function(self, ...)
		if getnamecallmethod() == "Kick" then return end
		return old(self, ...)
	end)
	setreadonly(mt, true)
end)
