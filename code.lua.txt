-- Tạo ScreenGui
local screenGui = Instance.new("ScreenGui", game.Players.LocalPlayer:WaitForChild("PlayerGui"))
screenGui.Name = "HackMenu"
screenGui.ResetOnSpawn = false

-- Tạo Frame chính (Menu)
local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0, 200, 0, 400) -- Tăng kích thước để chứa thêm slider
mainFrame.Position = UDim2.new(0, 20, 0, 100)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 0
mainFrame.Visible = true -- Đảm bảo menu luôn hiển thị lúc đầu
mainFrame.Active = true
mainFrame.Draggable = true

-- Tạo chữ "script by: Long Dzz" ở góc trên bên trái
local titleLabel = Instance.new("TextLabel", mainFrame)
titleLabel.Size = UDim2.new(0, 200, 0, 30)
titleLabel.Position = UDim2.new(0, 0, 0, 0)
titleLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextSize = 14
titleLabel.Text = "script by: Long Dzz"
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.TextYAlignment = Enum.TextYAlignment.Center

-- Tạo nút tròn mở menu
local toggleButton = Instance.new("TextButton", screenGui)
toggleButton.Size = UDim2.new(0, 50, 0, 50)
toggleButton.Position = UDim2.new(0, 20, 0, 50) -- Đặt nút cao hơn để không bị menu che
toggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 255)
toggleButton.Text = ""
toggleButton.BorderSizePixel = 0
toggleButton.Shape = Enum.TextButtonShape.Round

-- Thêm chữ vào nút tròn
local toggleButtonLabel = Instance.new("TextLabel", toggleButton)
toggleButtonLabel.Size = UDim2.new(1, 0, 1, 0)
toggleButtonLabel.Position = UDim2.new(0, 0, 0, 0)
toggleButtonLabel.BackgroundTransparency = 1
toggleButtonLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButtonLabel.Font = Enum.Font.SourceSansBold
toggleButtonLabel.TextSize = 18
toggleButtonLabel.Text = "☰"
toggleButtonLabel.TextAlign = Enum.TextXAlignment.Center
toggleButtonLabel.TextYAlignment = Enum.TextYAlignment.Center

-- Tween Animation cho Menu
local TweenService = game:GetService("TweenService")
local menuTweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Sine, Enum.EasingDirection.Out) -- Giảm thời gian tween cho mượt hơn

-- Biến trạng thái cho các chức năng
local autoClickerActive = false
local aimbotActive = false
local enlargeHitboxActive = false
local flying = false -- Biến trạng thái cho Fly

-- Hàm tạo các chức năng bật nhanh
local function createFastActionButton(name, yPosition, callback)
    -- Frame cho nút chức năng
    local actionFrame = Instance.new("Frame", mainFrame)
    actionFrame.Size = UDim2.new(1, -10, 0, 40)
    actionFrame.Position = UDim2.new(0, 5, 0, yPosition)
    actionFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    actionFrame.BorderSizePixel = 0

    -- Tên chức năng
    local label = Instance.new("TextLabel", actionFrame)
    label.Size = UDim2.new(0, 100, 1, 0)
    label.Position = UDim2.new(0, 10, 0, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = 14
    label.Text = name
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextYAlignment = Enum.TextYAlignment.Center

    -- Nút nhấn bật/tắt chức năng
    local button = Instance.new("TextButton", actionFrame)
    button.Size = UDim2.new(0, 60, 0, 20)
    button.Position = UDim2.new(1, -70, 0, 10)
    button.BackgroundColor3 = Color3.fromRGB(0, 255, 0) -- Màu xanh lá ban đầu (ON)
    button.Text = "ON"
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.SourceSansBold
    button.TextSize = 14
    button.BorderSizePixel = 0

    local isActive = false -- Trạng thái của nút hiện tại (ON/OFF)

    button.MouseButton1Click:Connect(function()
        isActive = not isActive -- Đảo ngược trạng thái
        if isActive then
            button.Text = "OFF"
            button.BackgroundColor3 = Color3.fromRGB(255, 0, 0) -- Đỏ khi OFF
            callback(true) -- Kích hoạt chức năng
        else
            button.Text = "ON"
            button.BackgroundColor3 = Color3.fromRGB(0, 255, 0) -- Xanh lá khi ON
            callback(false) -- Tắt chức năng
        end
    end)
end

-- Hàm Auto Clicker
local function runAutoClicker()
    local mouse = game.Players.LocalPlayer:GetMouse()
    while autoClickerActive do
        mouse1click() -- Gọi sự kiện click chuột
        wait(clickSpeedSlider.Value) -- Tốc độ click (có thể điều chỉnh)
    end
end

-- Hàm Aimbot
local heartbeatConnection

local function runAimbot()
    local player = game.Players.LocalPlayer
    local mouse = player:GetMouse()
    local smoothingFactor = 0.2

    heartbeatConnection = game:GetService("RunService").Heartbeat:Connect(function(deltaTime)
        local char = player.Character
        if not char or not char:FindFirstChild("HumanoidRootPart") then
            return -- Thoát khỏi hàm nếu không tìm thấy
        end

        local closestPlayer = nil
        local closestDistance = math.huge
        local targetPart = nil

        for _, otherPlayer in pairs(game.Players:GetPlayers()) do
            if otherPlayer ~= player and otherPlayer.Character then
                local targetChar = otherPlayer.Character
                local humanoidRootPart = targetChar:FindFirstChild("HumanoidRootPart")
                if humanoidRootPart then
                    local dist = (humanoidRootPart.Position - char.HumanoidRootPart.Position).Magnitude
                    if dist < closestDistance then
                        closestDistance = dist
                        closestPlayer = otherPlayer
                        targetPart = humanoidRootPart
                    end
                end
            end
        end

        if targetPart then
            local targetPosition = targetPart.CFrame.Position
            local currentPosition = mouse.Hit.Position
            local newPosition = currentPosition:Lerp(targetPosition, smoothingFactor)

            mouse.TargetFilter = targetPart
            mouse.Hit = CFrame.new(newPosition)
        else
            mouse.TargetFilter = nil
        end
    end)
end

-- Hiển thị/ẩn menu khi nhấn vào nút tròn với animation
toggleButton.MouseButton1Click:Connect(function()
    local goal
    if mainFrame.Visible then
        goal = {Position = UDim2.new(0, 20, 0, 100)} -- Vị trí khi ẩn
        TweenService:Create(mainFrame, menuTweenInfo, goal):Play()
        -- Đợi tween hoàn thành trước khi ẩn hẳn
        task.wait(menuTweenInfo.Time)
        mainFrame.Visible = false
    else
        goal = {Position = UDim2.new(0, 20, 0, 100)} -- Vị trí khi hiện
        mainFrame.Visible = true
        TweenService:Create(mainFrame, menuTweenInfo, goal):Play()
    end
end)

-- Các tính năng nhanh
createFastActionButton("Auto Clicker", 40, function(state)
    autoClickerActive = state
    if state then
        runAutoClicker()
    end
end)

createFastActionButton("Aimbot", 90, function(state)
    aimbotActive = state
    if state then
        runAimbot()
    elseif heartbeatConnection then
        heartbeatConnection:Disconnect() -- Tắt Aimbot
    end
end)

createFastActionButton("Enlarge Hitbox", 140, function(state)
    enlargeHitboxActive = state
    -- Thực hiện thay đổi hitbox ở đây
end)

createFastActionButton("Fly", 190, function(state)
    flying = state
    -- Thực hiện thay đổi fly ở đây
end)
