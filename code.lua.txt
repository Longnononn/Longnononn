-- script by Long dzz (đã tối ưu thêm bởi ChatGPT & Gemini)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")

local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local hrp = character:WaitForChild("HumanoidRootPart")

local walkSpeedDefault = 16
local walkSpeedBoost = 28

local noclipEnabled = false
local speedEnabled = false
local autoStealEnabled = false

local stealRange = 15 -- Khoảng cách tối đa để có thể cướp (có thể điều chỉnh)
local lastStealTime = 0
local stealCooldown = 0.5 -- Thời gian cooldown giữa các lần cướp

-- GUI setup (ngụy trang)
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SysCoreUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Nút mở giao diện
local toggleGuiButton = Instance.new("TextButton")
toggleGuiButton.Size = UDim2.new(0, 40, 0, 40)
toggleGuiButton.Position = UDim2.new(0, 10, 0, 10)
toggleGuiButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
toggleGuiButton.Text = "+"
toggleGuiButton.TextScaled = true
toggleGuiButton.TextColor3 = Color3.new(1, 1, 1)
toggleGuiButton.BorderSizePixel = 0
toggleGuiButton.AutoButtonColor = false
toggleGuiButton.Font = Enum.Font.GothamBlack
toggleGuiButton.Parent = screenGui
local corner = Instance.new("UICorner")
corner.Parent = toggleGuiButton

-- Frame chính
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 160, 0, 170)
mainFrame.Position = UDim2.new(0, 60, 0, 10)
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
mainFrame.Visible = false
mainFrame.Parent = screenGui
local mainCorner = Instance.new("UICorner")
mainCorner.Parent = mainFrame

-- Text tác giả
local creditText = Instance.new("TextLabel")
creditText.Size = UDim2.new(1, 0, 0, 20)
creditText.Position = UDim2.new(0, 0, 0, 0)
creditText.BackgroundTransparency = 1
creditText.Text = "script by Long dzz"
creditText.TextColor3 = Color3.new(1, 1, 1)
creditText.Font = Enum.Font.Gotham
creditText.TextScaled = true
creditText.Parent = mainFrame

-- Nút bật/tắt speed + noclip
local toggleSpeedBtn = Instance.new("TextButton")
toggleSpeedBtn.Size = UDim2.new(1, -20, 0, 30)
toggleSpeedBtn.Position = UDim2.new(0, 10, 0, 25)
toggleSpeedBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
toggleSpeedBtn.Text = "Speed/Noclip: OFF"
toggleSpeedBtn.TextScaled = true
toggleSpeedBtn.Font = Enum.Font.GothamBold
toggleSpeedBtn.TextColor3 = Color3.new(1, 1, 1)
toggleSpeedBtn.Parent = mainFrame
local toggleSpeedCorner = Instance.new("UICorner")
toggleSpeedCorner.Parent = toggleSpeedBtn

-- Nút bật/tắt cướp nhanh
local toggleAutoStealBtn = Instance.new("TextButton")
toggleAutoStealBtn.Size = UDim2.new(1, -20, 0, 30)
toggleAutoStealBtn.Position = UDim2.new(0, 10, 0, 65)
toggleAutoStealBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
toggleAutoStealBtn.Text = "Auto Cướp: OFF"
toggleAutoStealBtn.TextScaled = true
toggleAutoStealBtn.Font = Enum.Font.GothamBold
toggleAutoStealBtn.TextColor3 = Color3.new(1, 1, 1)
toggleAutoStealBtn.Parent = mainFrame
local toggleAutoStealCorner = Instance.new("UICorner")
toggleAutoStealCorner.Parent = toggleAutoStealBtn

-- Nút cướp nhanh thủ công
local stealBtn = Instance.new("TextButton")
stealBtn.Size = UDim2.new(1, -20, 0, 30)
stealBtn.Position = UDim2.new(0, 10, 0, 105)
stealBtn.BackgroundColor3 = Color3.fromRGB(255, 150, 0)
stealBtn.Text = "Cướp nhanh"
stealBtn.TextScaled = true
stealBtn.Font = Enum.Font.GothamBold
stealBtn.TextColor3 = Color3.new(1, 1, 1)
stealBtn.Parent = mainFrame
local stealBtnCorner = Instance.new("UICorner")
stealBtnCorner.Parent = stealBtn

-- Nút thoát giả
local fakeExit = Instance.new("TextButton")
fakeExit.Size = UDim2.new(1, -20, 0, 30)
fakeExit.Position = UDim2.new(0, 10, 0, 145)
fakeExit.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
fakeExit.Text = "Thoát giả"
fakeExit.TextScaled = true
fakeExit.Font = Enum.Font.Gotham
fakeExit.TextColor3 = Color3.fromRGB(1, 1, 1)
fakeExit.Parent = mainFrame
local fakeExitCorner = Instance.new("UICorner")
fakeExitCorner.Parent = fakeExit

-- Hàm cập nhật trạng thái speed/noclip
local function updateSpeedNoclip(state)
	noclipEnabled = state
	speedEnabled = state
	if speedEnabled then
		humanoid.WalkSpeed = walkSpeedBoost
		toggleSpeedBtn.Text = "Speed/Noclip: ON"
		toggleSpeedBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
	else
		humanoid.WalkSpeed = walkSpeedDefault
		toggleSpeedBtn.Text = "Speed/Noclip: OFF"
		toggleSpeedBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
	end
end

-- Hàm cập nhật trạng thái auto cướp
local function updateAutoSteal(state)
	autoStealEnabled = state
	if autoStealEnabled then
		toggleAutoStealBtn.Text = "Auto Cướp: ON"
		toggleAutoStealBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
	else
		toggleAutoStealBtn.Text = "Auto Cướp: OFF"
		toggleAutoStealBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
	end
end

-- Tìm mục tiêu cướp gần nhất
local function findNearestStealableTarget()
    local nearestTarget = nil
    local shortestDistance = stealRange + 1
    local playerPos = hrp.Position

    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("BasePart") and obj.Name == "StealableItem" then
            local dist = (obj.Position - playerPos).Magnitude
            if dist <= stealRange and dist < shortestDistance then
                shortestDistance = dist
                nearestTarget = obj
            end
        end
    end
    return nearestTarget
end

-- Hàm thực hiện cướp
local function doSteal()
	if tick() - lastStealTime < stealCooldown then
		return
	end

	local target = findNearestStealableTarget()
	if target then
		local stealRemote = ReplicatedStorage:FindFirstChild("StealPet")
		if stealRemote and stealRemote:IsA("RemoteEvent") then
			stealRemote:FireServer(target)
			print("Đã gửi yêu cầu cướp:", target.Name)
			lastStealTime = tick()
		else
			warn("Không tìm thấy RemoteEvent 'StealPet' hợp lệ.")
		end
	end
end

-- Bật/tắt GUI chính
toggleGuiButton.MouseButton1Click:Connect(function()
	mainFrame.Visible = not mainFrame.Visible
end)

-- Bật/tắt speed/noclip
toggleSpeedBtn.MouseButton1Click:Connect(function()
	updateSpeedNoclip(not speedEnabled)
end)

-- Bật/tắt auto cướp
toggleAutoStealBtn.MouseButton1Click:Connect(function()
	updateAutoSteal(not autoStealEnabled)
end)

-- Cướp nhanh thủ công
stealBtn.MouseButton1Click:Connect(function()
	doSteal()
end)

-- Fake Exit
local function activateFakeExit()
	mainFrame.Visible = false
	toggleGuiButton.Visible = false
	warn("AntiBan: Fake quit đã kích hoạt.")
end
fakeExit.MouseButton1Click:Connect(activateFakeExit)
activateFakeExit() -- tự động chạy

-- Noclip xử lý mỗi frame khi bật
RunService.Stepped:Connect(function()
	if noclipEnabled and character and hrp then
		for _, part in ipairs(character:GetDescendants()) do
			if part:IsA("BasePart") and part.CanCollide == true and part.Name ~= "HumanoidRootPart" then
				part.CanCollide = false
			end
		end
	end
end)

-- Auto cướp liên tục nếu bật
RunService.Heartbeat:Connect(function()
	if autoStealEnabled then
		doSteal()
	end
end)

-- Bắt sự kiện nhân vật respawn
player.CharacterAdded:Connect(function(char)
	character = char
	humanoid = char:WaitForChild("Humanoid")
	hrp = char:WaitForChild("HumanoidRootPart")
	if speedEnabled then
		humanoid.WalkSpeed = walkSpeedBoost
	end
	-- Có thể ẩn UI hoặc không
	-- activateFakeExit()
end)

-- Basic AntiKick
local mt = getrawmetatable(game)
setreadonly(mt, false)
local oldNamecall = mt.__namecall
mt.__namecall = newcclosure(function(self, ...)
	local method = getnamecallmethod()
	if method == "Kick" then
		warn("Blocked Kick attempt.")
		return nil
	end
	return oldNamecall(self, ...)
end)
setreadonly(mt, true)
