-- script by Long dzz (tối ưu bởi ChatGPT)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UIS = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local player = Players.LocalPlayer

-- Khởi tạo biến
local character
local humanoid
local walkSpeedDefault = 16
local walkSpeedBoost = 28
local noclipEnabled = false
local speedEnabled = false
local stealRange = 15
local lastStealTime = 0
local stealCooldown = 0.5

-- Cập nhật lại nhân vật mỗi khi respawn
local function updateCharacterReferences()
	character = player.Character or player.CharacterAdded:Wait()
	humanoid = character:WaitForChild("Humanoid")
	character:WaitForChild("HumanoidRootPart")
end

updateCharacterReferences()

player.CharacterAdded:Connect(function()
	updateCharacterReferences()
	if speedEnabled then
		humanoid.WalkSpeed = walkSpeedBoost
	end
end)

-- Tạo GUI ngụy trang
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SysCoreUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local toggleGuiButton = Instance.new("TextButton")
toggleGuiButton.Size = UDim2.new(0, 40, 0, 40)
toggleGuiButton.Position = UDim2.new(0, 10, 0, 10)
toggleGuiButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
toggleGuiButton.Text = "+"
toggleGuiButton.TextScaled = true
toggleGuiButton.TextColor3 = Color3.new(1, 1, 1)
toggleGuiButton.BorderSizePixel = 0
toggleGuiButton.AutoButtonColor = false
toggleGuiButton.Font = Enum.Font.GothamBlack
toggleGuiButton.Parent = screenGui
toggleGuiButton.Name = "SysBtn"
Instance.new("UICorner", toggleGuiButton)

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 160, 0, 130)
mainFrame.Position = UDim2.new(0, 60, 0, 10)
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
mainFrame.Visible = false
mainFrame.Parent = screenGui
Instance.new("UICorner", mainFrame)

local creditText = Instance.new("TextLabel")
creditText.Size = UDim2.new(1, 0, 0, 20)
creditText.Position = UDim2.new(0, 0, 0, 0)
creditText.BackgroundTransparency = 1
creditText.Text = "script by Long dzz"
creditText.TextColor3 = Color3.new(1, 1, 1)
creditText.Font = Enum.Font.Gotham
creditText.TextScaled = true
creditText.Parent = mainFrame

local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(1, -20, 0, 30)
toggleBtn.Position = UDim2.new(0, 10, 0, 25)
toggleBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
toggleBtn.Text = "OFF"
toggleBtn.TextScaled = true
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Parent = mainFrame
Instance.new("UICorner", toggleBtn)

local stealBtn = Instance.new("TextButton")
stealBtn.Size = UDim2.new(1, -20, 0, 30)
stealBtn.Position = UDim2.new(0, 10, 0, 65)
stealBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
stealBtn.Text = "CƯỚP NHANH"
stealBtn.TextScaled = true
stealBtn.Font = Enum.Font.GothamBold
stealBtn.TextColor3 = Color3.new(1, 1, 1)
stealBtn.Visible = true
stealBtn.Parent = mainFrame
Instance.new("UICorner", stealBtn)

local fakeExit = Instance.new("TextButton")
fakeExit.Size = UDim2.new(1, -20, 0, 30)
fakeExit.Position = UDim2.new(0, 10, 0, 105)
fakeExit.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
fakeExit.Text = "Thoát giả"
fakeExit.TextScaled = true
fakeExit.Font = Enum.Font.Gotham
fakeExit.TextColor3 = Color3.fromRGB(1, 1, 1)
fakeExit.Parent = mainFrame
Instance.new("UICorner", fakeExit)

-- Tăng tốc / noclip toggle
local function updateState(state)
	noclipEnabled = state
	speedEnabled = state

	if speedEnabled then
		humanoid.WalkSpeed = walkSpeedBoost
		toggleBtn.Text = "ON"
		toggleBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
	else
		humanoid.WalkSpeed = walkSpeedDefault
		toggleBtn.Text = "OFF"
		toggleBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
	end
end

-- GUI toggle
toggleGuiButton.MouseButton1Click:Connect(function()
	mainFrame.Visible = not mainFrame.Visible
end)

toggleBtn.MouseButton1Click:Connect(function()
	updateState(not speedEnabled)
end)

-- Tìm vật thể có thể cướp
local function findNearestStealableTarget()
	local nearestTarget
	local shortestDistance = stealRange + 1
	local pos = character:WaitForChild("HumanoidRootPart").Position

	for _, obj in pairs(Workspace:GetDescendants()) do
		if obj:IsA("BasePart") and obj.Name == "StealableItem" then
			local dist = (obj.Position - pos).Magnitude
			if dist <= stealRange and dist < shortestDistance then
				nearestTarget = obj
				shortestDistance = dist
			end
		end
	end

	return nearestTarget
end

-- Nút cướp
stealBtn.MouseButton1Click:Connect(function()
	if tick() - lastStealTime < stealCooldown then
		warn("Steal on cooldown.")
		return
	end

	local target = findNearestStealableTarget()
	if not target then
		warn("Không tìm thấy mục tiêu.")
		return
	end

	local remote = ReplicatedStorage:FindFirstChild("StealPet")
	if remote and remote:IsA("RemoteEvent") then
		local success, err = pcall(function()
			remote:FireServer(target)
		end)
		if success then
			print("Đã gửi yêu cầu cướp:", target.Name)
			lastStealTime = tick()
		else
			warn("Lỗi gửi yêu cầu:", err)
		end
	else
		warn("Không tìm thấy RemoteEvent 'StealPet'")
	end
end)

-- Thoát giả
local function activateFakeExit()
	mainFrame.Visible = false
	toggleGuiButton.Visible = false
	warn("AntiBan: Đã ẩn GUI.")
end

fakeExit.MouseButton1Click:Connect(activateFakeExit)

-- NoClip thông minh
RunService.Stepped:Connect(function()
	if character and character:FindFirstChild("HumanoidRootPart") then
		for _, v in ipairs(character:GetDescendants()) do
			if v:IsA("BasePart") and v.Name ~= "HumanoidRootPart" then
				v.CanCollide = not noclipEnabled
			end
		end
	end
end)

-- AntiKick an toàn hơn
local success, mt = pcall(getrawmetatable, game)
if success and mt then
	setreadonly(mt, false)
	local oldNamecall = mt.__namecall
	mt.__namecall = newcclosure(function(self, ...)
		if getnamecallmethod() == "Kick" and self == player then
			warn("[AntiKick] Chặn kick.")
			return
		end
		return oldNamecall(self, ...)
	end)
	setreadonly(mt, true)
end
